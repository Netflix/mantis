



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>The Sink Component - Mantis</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
      <script src="../../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../css/extra.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#built-in-sinks" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="Mantis" class="md-header-nav__button md-logo">
          
            <img src="../../../images/logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Mantis
            </span>
            <span class="md-header-nav__topic">
              
                The Sink Component
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/netflix/mantis/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Github
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../.." title="Mantis" class="md-nav__button md-logo">
      
        <img src="../../../images/logo.png" width="48" height="48">
      
    </a>
    Mantis
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/netflix/mantis/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Github
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Welcome to Mantis" class="md-nav__link">
      Welcome to Mantis
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../gettingstarted/" title="Getting Started Guide" class="md-nav__link">
      Getting Started Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../gettingstarted/concepts/" title="Mantis Concepts" class="md-nav__link">
      Mantis Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../gettingstarted/usecases/" title="Use cases" class="md-nav__link">
      Use cases
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../gettingstarted/local/" title="Explore a Mantis Job locally" class="md-nav__link">
      Explore a Mantis Job locally
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../gettingstarted/docker/" title="Mantis Cluster using Docker" class="md-nav__link">
      Mantis Cluster using Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../gettingstarted/cloud/" title="Mantis Cluster in the cloud" class="md-nav__link">
      Mantis Cluster in the cloud
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-7" type="checkbox" id="nav-2-7">
    
    <label class="md-nav__link" for="nav-2-7">
      Mantis Samples
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-7">
        Mantis Samples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../gettingstarted/samples/sinesample/" title="Sine Function" class="md-nav__link">
      Sine Function
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../gettingstarted/samples/twittersample/" title="Twitter Sample" class="md-nav__link">
      Twitter Sample
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../gettingstarted/samples/publishsample/" title="Publish to Mantis Sample" class="md-nav__link">
      Publish to Mantis Sample
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Developing with Mantis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Developing with Mantis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../mre/" title="Publishing Events into Mantis" class="md-nav__link">
      Publishing Events into Mantis
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2" checked>
    
    <label class="md-nav__link" for="nav-3-2">
      Writing Mantis Jobs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Writing Mantis Jobs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Introduction to Mantis Jobs" class="md-nav__link">
      Introduction to Mantis Jobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../source/" title="The Source Component" class="md-nav__link">
      The Source Component
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../stage/" title="The Processing Stage Component" class="md-nav__link">
      The Processing Stage Component
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        The Sink Component
      </label>
    
    <a href="./" title="The Sink Component" class="md-nav__link md-nav__link--active">
      The Sink Component
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#built-in-sinks" class="md-nav__link">
    Built-in Sinks
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sse-sink" class="md-nav__link">
    SSE Sink
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sysout-sink" class="md-nav__link">
    sysout Sink
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eagersubscribe-sink" class="md-nav__link">
    eagerSubscribe Sink
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tomany-sink" class="md-nav__link">
    toMany Sink
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-sinks" class="md-nav__link">
    Custom Sinks
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../wordcount/" title="Writing Your First Job" class="md-nav__link">
      Writing Your First Job
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../twitter/" title="Writing Your Second Job" class="md-nav__link">
      Writing Your Second Job
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../groupby/" title="Writing Your Third Job" class="md-nav__link">
      Writing Your Third Job
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3">
    
    <label class="md-nav__link" for="nav-3-3">
      Querying Streams in Mantis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        Querying Streams in Mantis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../mql/" title="Introduction to MQL" class="md-nav__link">
      Introduction to MQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mql/operators/" title="Operators" class="md-nav__link">
      Operators
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mql/sampling/" title="Sampling" class="md-nav__link">
      Sampling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mql/aggregation-scaling-limits/" title="Scaling Limits" class="md-nav__link">
      Scaling Limits
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4">
    
    <label class="md-nav__link" for="nav-3-4">
      The Mantis API
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-4">
        The Mantis API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/" title="API Reference" class="md-nav__link">
      API Reference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/websocket/" title="Websocket API" class="md-nav__link">
      Websocket API
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cli/" title="The Mantis CLI" class="md-nav__link">
      The Mantis CLI
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Mantis in Production
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Mantis in Production
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../production/capacity/" title="Mantis Job Capacity Planning & Sizing" class="md-nav__link">
      Mantis Job Capacity Planning & Sizing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../production/autoscaling/" title="Mantis Job Autoscaling" class="md-nav__link">
      Mantis Job Autoscaling
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Mantis Internals
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Mantis Internals
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../internals/infrastructure/" title="Infrastructure Overview" class="md-nav__link">
      Infrastructure Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../internals/sourcejobs/" title="Mantis Source Jobs" class="md-nav__link">
      Mantis Source Jobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../internals/runtime/" title="Mantis Runtime" class="md-nav__link">
      Mantis Runtime
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../internals/localdockersetup/" title="Local Development" class="md-nav__link">
      Local Development
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../community/" title="Community" class="md-nav__link">
      Community
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../glossary/" title="Glossary" class="md-nav__link">
      Glossary
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#built-in-sinks" class="md-nav__link">
    Built-in Sinks
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sse-sink" class="md-nav__link">
    SSE Sink
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sysout-sink" class="md-nav__link">
    sysout Sink
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eagersubscribe-sink" class="md-nav__link">
    eagerSubscribe Sink
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tomany-sink" class="md-nav__link">
    toMany Sink
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-sinks" class="md-nav__link">
    Custom Sinks
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/netflix/mantis/edit/master/docs/developing/writingjobs/sink.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>The Sink Component</h1>
                
                <p>The <a href="../../glossary#sink" title="The Sink is the final component of a Mantis Job. It takes the Observable that has been transformed by the Processing Stage and outputs it in the form of a new data stream.">Sink</a>  <a href="../../glossary#component" title="A Mantis Job is composed of three types of component: a Source, one or more Processing Stages, and a Sink.">component</a> of a <a href="../../glossary#job" title="A Mantis Job takes in a stream of data, transforms it by using RxJava operators, and then outputs the results as another stream. It is composed of a Source, one or more Processing Stages, and a Sink.">Mantis Job</a> serves two purposes:</p>
<ol>
<li>
<p><strong>Trigger job execution when a client subscribes to a Job</strong></p>
<p><a href="../../glossary#rxjava" title="RxJava is the Java implementation of ReactiveX, a software technique for transforming, combining, reacting to, and managing streams of data.">RxJava</a>  <a href="../../glossary#cold" title="A cold ReactiveX Observable waits until an observer subscribes to it before it begins to emit items. This means the observer is guaranteed to see the whole Observable sequence from the beginning. This is in contrast to a hot Observable, which may begin emitting items as soon as it is created, even before observers have subscribed to it.">cold Observables</a> have a lazy execution model. Execution begins only when someone
subscribes to the Observable. A Mantis Job is a complex Observable chain, and to trigger the
execution of such a Job, somebody needs to subscribe to it. This happens in the Sink component.</p>
</li>
<li>
<p><strong>Output the results of job execution in a streaming fashion</strong></p>
<p>Once you are done processing the input stream in the <a href="../../glossary#stage" title="A Processing Stage component of a Mantis Job transforms the RxJava Observables it obtains from the Source component.">Processing Stage</a> component, you need to
figure out what to do with the results. Most jobs that write to some other system do so within
the Processing Stage component itself (in such a case, the Sink component is usually used for
debugging purposes).</p>
</li>
</ol>
<p>To create a Sink component, you implement the <code>Sink</code> interface:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">io.mantisrx.runtime.Context</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">io.mantisrx.runtime.PortRequest</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">rx.Observable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">rx.functions.Action3</span><span class="p">;</span>

<span class="hll"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Sink</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">Action3</span><span class="o">&lt;</span><span class="n">Context</span><span class="p">,</span> <span class="n">PortRequest</span><span class="p">,</span> <span class="n">Observable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="p">{</span> <span class="p">}</span>
</span></pre></div>


<h2 id="built-in-sinks">Built-in Sinks<a class="headerlink" href="#built-in-sinks" title="Permanent link">&para;</a></h2>
<p>Some Sinks are provided by Mantis. To get access to these Sinks, add this line to your source:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">io.mantisrx.runtime.sink.Sinks</span><span class="p">;</span>
</pre></div>


<h3 id="sse-sink">SSE Sink<a class="headerlink" href="#sse-sink" title="Permanent link">&para;</a></h3>
<p>The <a href="../../glossary#sse" title="Server-sent events (SSE) are a way for a browser to receive automatic updates from a server through an HTTP connection. Mantis includes an SSE Sink.">SSE</a> Sink is commonly used. It makes the results of your Stage transformation available in the
form of an SSE stream.</p>
<p>To get an SSE Sink, pass an encoder function to the <code>sse()</code> method that accepts the data to be
streamed as input and outputs data encoded as needed. The following example attaches a sink to a
Mantis Job that passes the data from the last Processing Stage of the job, unchanged, to the SSE
stream:</p>
<div class="codehilite"><pre><span></span><span class="k">return</span> <span class="n">MantisJob</span><span class="p">.</span> <span class="err">…</span> <span class="p">.</span><span class="na">sink</span><span class="p">(</span><span class="n">Sinks</span><span class="p">.</span><span class="na">sse</span><span class="p">((</span><span class="n">String</span> <span class="n">data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">data</span><span class="p">)).</span> <span class="err">…</span> <span class="p">.</span><span class="na">create</span><span class="p">();</span>
</pre></div>


<h3 id="sysout-sink">sysout Sink<a class="headerlink" href="#sysout-sink" title="Permanent link">&para;</a></h3>
<p>The <code>sysout</code> Sink simply outputs the results from the previous Processing Stage directly to sysout.
For example:</p>
<div class="codehilite"><pre><span></span><span class="k">return</span> <span class="n">MantisJob</span><span class="p">.</span> <span class="err">…</span> <span class="p">.</span><span class="na">sink</span><span class="p">(</span><span class="n">Sinks</span><span class="p">.</span><span class="na">sysout</span><span class="p">()).</span> <span class="err">…</span> <span class="p">.</span><span class="na">create</span><span class="p">();</span>
</pre></div>


<h3 id="eagersubscribe-sink">eagerSubscribe Sink<a class="headerlink" href="#eagersubscribe-sink" title="Permanent link">&para;</a></h3>
<p>A typical Sink subscribes to the output of the previous Processing Stage at some point during the
call to its <code>call()</code> method. You may want some of your Mantis Jobs to start executing as soon as you
launch them. These include Jobs that run perpetually and power things like alerts, dashboards, and
so forth.</p>
<p>You can modify a Sink with <code>eagerSubscribe()</code> to create a Sink that that instead subscribes to the
output of the previous Processing Stage <em>immediately</em> when its <code>call()</code> method is called, even if it
has more processing to do within that method before it can respond to the output. This will start
your Mantis Job more quickly, but may mean some of its initial data is dropped.</p>
<p>For example:</p>
<div class="codehilite"><pre><span></span><span class="k">return</span> <span class="n">MantisJob</span><span class="p">.</span> <span class="err">…</span> <span class="p">.</span><span class="na">sink</span><span class="p">(</span><span class="n">Sinks</span><span class="p">.</span><span class="na">eagerSubscribe</span><span class="p">(</span><span class="n">Sinks</span><span class="p">.</span><span class="na">sse</span><span class="p">((</span><span class="n">String</span> <span class="n">data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">data</span><span class="p">))).</span> <span class="err">…</span> <span class="p">.</span><span class="na">create</span><span class="p">();</span>
</pre></div>


<p>Here is a more complete example:</p>
<div class="codehilite"><pre><span></span><span class="k">return</span> <span class="n">MantisJob</span>        
        <span class="c1">// Reuse existing class that does all the plumbing of connecting to source jobs</span>
        <span class="p">.</span><span class="na">source</span><span class="p">(</span><span class="k">new</span> <span class="n">JobSource</span><span class="p">())</span>

        <span class="c1">// Groups requests by ESN</span>
        <span class="p">.</span><span class="na">stage</span><span class="p">(</span><span class="k">new</span> <span class="n">GroupByStage</span><span class="p">(),</span> <span class="n">GroupByStage</span><span class="p">.</span><span class="na">config</span><span class="p">())</span>

        <span class="c1">// Computes sum over a window</span>
        <span class="p">.</span><span class="na">stage</span><span class="p">(</span><span class="k">new</span> <span class="n">FastAggregateStage</span><span class="p">(),</span> <span class="n">FastAggregateStage</span><span class="p">.</span><span class="na">config</span><span class="p">())</span>

        <span class="c1">// Collects the data and makes it availabe over SSE</span>
        <span class="p">.</span><span class="na">stage</span><span class="p">(</span><span class="k">new</span> <span class="n">CollectStage</span><span class="p">(),</span> <span class="n">CollectStage</span><span class="p">.</span><span class="na">config</span><span class="p">())</span>

        <span class="c1">// Reuse built in sink that eagerly subscribes and delivers data over SSE</span>
        <span class="p">.</span><span class="na">sink</span><span class="p">(</span><span class="n">Sinks</span><span class="p">.</span><span class="na">eagerSubscribe</span><span class="p">(</span>
                <span class="n">Sinks</span><span class="p">.</span><span class="na">sse</span><span class="p">((</span><span class="n">String</span> <span class="n">data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">data</span><span class="p">)</span>
             <span class="p">))</span>

            <span class="c1">// Here we define the job parameter overrides        </span>

            <span class="c1">// The query sent to the source job.</span>
            <span class="c1">// Here we fetch the esn for all requests hitting the source</span>
            <span class="p">.</span><span class="na">parameterDefinition</span><span class="p">(</span><span class="k">new</span> <span class="n">StringParameter</span><span class="p">()</span>
            <span class="p">.</span><span class="na">name</span><span class="p">(</span><span class="n">MantisSourceJobConnector</span><span class="p">.</span><span class="na">MANTIS_SOURCEJOB_CRITERION</span><span class="p">)</span>
            <span class="p">.</span><span class="na">validator</span><span class="p">(</span><span class="n">Validators</span><span class="p">.</span><span class="na">notNullOrEmpty</span><span class="p">())</span>
            <span class="p">.</span><span class="na">defaultValue</span><span class="p">(</span><span class="s">&quot;SELECT customer_id, client_ip WHERE true&quot;</span><span class="p">)</span>
            <span class="p">.</span><span class="na">build</span><span class="p">())</span>    

        <span class="p">.</span><span class="na">metadata</span><span class="p">(</span><span class="k">new</span> <span class="n">Metadata</span><span class="p">.</span><span class="na">Builder</span><span class="p">()</span>
            <span class="p">.</span><span class="na">name</span><span class="p">(</span><span class="s">&quot;GroupByIp&quot;</span><span class="p">)</span>
            <span class="p">.</span><span class="na">description</span><span class="p">(</span><span class="s">&quot;Connects to a source job and counts the number of requests sent from each ip within a window&quot;</span><span class="p">)</span>
            <span class="p">.</span><span class="na">build</span><span class="p">())</span>
        <span class="p">.</span><span class="na">create</span><span class="p">();</span>
</pre></div>


<h3 id="tomany-sink">toMany Sink<a class="headerlink" href="#tomany-sink" title="Permanent link">&para;</a></h3>
<p>You can hook up multiple Sinks to the same final Stage of a Job by using the <code>toMany</code> Sink. To do
this, pass each Sink to the <code>toMany()</code> method. For example:</p>
<div class="codehilite"><pre><span></span><span class="k">return</span> <span class="n">MantisJob</span><span class="p">.</span> <span class="err">…</span> <span class="p">.</span><span class="na">sink</span><span class="p">(</span><span class="n">Sinks</span><span class="p">.</span><span class="na">toMany</span><span class="p">(</span><span class="n">Sinks</span><span class="p">.</span><span class="na">sysout</span><span class="p">(),</span> <span class="n">Sinks</span><span class="p">.</span><span class="na">sse</span><span class="p">((</span><span class="n">String</span> <span class="n">data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">data</span><span class="p">))).</span> <span class="err">…</span> <span class="p">.</span><span class="na">create</span><span class="p">();</span>
</pre></div>


<h2 id="custom-sinks">Custom Sinks<a class="headerlink" href="#custom-sinks" title="Permanent link">&para;</a></h2>
<p>If you do not want to use one of the provided Sinks, or if you need to customize one of those (for
instance, if you need access to the query parameters supplied by a client who is connecting into
your Job, or if you need pre and post hooks to perform operations as a new client connects or
disconnects), you can create your own Sink. To do so, implement the <code>Sink</code> interface.</p>
<p>The <code>ServerSentEventsSink</code> builder takes three parameters:</p>
<ol>
<li>
<p><strong>Preprocess function</strong></p>
<p>this callback gives you access to the query parameters; it is invoked before job execution
begins</p>
</li>
<li>
<p><strong>Postprocess function</strong></p>
<p>this callback allows you to perform any clean-up actions; it is invoked just after the client
connection is terminated</p>
</li>
<li>
<p><strong>Predicate function</strong></p>
<p>allows you to filter your output stream based on the given predicate, which allows you to filter
based on query parameters sent by the client</p>
</li>
</ol>
<p>Here is an example of a custom Sink that uses the <code>ServerSentEventsSink</code> builder:</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.netflix.mantis.sourcejob</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">io.mantisrx.runtime.Context</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">io.mantisrx.runtime.PortRequest</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">io.mantisrx.runtime.sink.ServerSentEventsSink</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">io.mantisrx.runtime.sink.Sink</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">io.mantisrx.runtime.sink.predicate.Predicate</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">rx.Observable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">rx.functions.Func1</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">rx.functions.Func2</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.google.common.base.Charsets</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SourceSink</span> <span class="kd">implements</span> <span class="n">Sink</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="p">{</span>

  <span class="n">Func2</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="n">Context</span><span class="p">,</span><span class="n">Void</span><span class="o">&gt;</span> <span class="n">preProcessor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NoOpProcessor</span><span class="p">();</span>
  <span class="n">Func2</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="n">Context</span><span class="p">,</span><span class="n">Void</span><span class="o">&gt;</span> <span class="n">postProcessor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NoOpProcessor</span><span class="p">();</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">clientId</span> <span class="o">=</span> <span class="s">&quot;DEFAULT_CLIENT_ID&quot;</span><span class="p">;</span>

  <span class="kd">static</span> <span class="kd">class</span> <span class="nc">NoOpProcessor</span> <span class="kd">implements</span> <span class="n">Func2</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="n">Context</span><span class="p">,</span><span class="n">Void</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Void</span> <span class="nf">call</span><span class="p">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">t1</span><span class="p">,</span> <span class="n">Context</span> <span class="n">t2</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="nf">SourceSink</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="nf">SourceSink</span><span class="p">(</span><span class="n">Func2</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="n">Context</span><span class="p">,</span><span class="n">Void</span><span class="o">&gt;</span> <span class="n">preProcessor</span><span class="p">,</span>
           <span class="n">Func2</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="n">Context</span><span class="p">,</span><span class="n">Void</span><span class="o">&gt;</span> <span class="n">postProcessor</span><span class="p">,</span>
           <span class="n">String</span> <span class="n">mantisClientId</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">postProcessor</span> <span class="o">=</span> <span class="n">postProcessor</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">preProcessor</span> <span class="o">=</span> <span class="n">preProcessor</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">clientId</span> <span class="o">=</span> <span class="n">mantisClientId</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">call</span><span class="p">(</span><span class="n">Context</span> <span class="n">context</span><span class="p">,</span> <span class="n">PortRequest</span> <span class="n">portRequest</span><span class="p">,</span>
                   <span class="n">Observable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">observable</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">observable</span> <span class="o">=</span> <span class="n">observable</span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="k">new</span> <span class="n">Func1</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Boolean</span><span class="o">&gt;</span><span class="p">()</span> <span class="p">{</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="n">Boolean</span> <span class="nf">call</span><span class="p">(</span><span class="n">String</span> <span class="n">t1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">!</span><span class="n">t1</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">});</span>

    <span class="n">ServerSentEventsSink</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">sink</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerSentEventsSink</span><span class="p">.</span><span class="na">Builder</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">()</span>
    <span class="p">.</span><span class="na">withEncoder</span><span class="p">(</span><span class="k">new</span> <span class="n">Func1</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;</span><span class="p">()</span> <span class="p">{</span>
      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="n">String</span> <span class="nf">call</span><span class="p">(</span><span class="n">String</span> <span class="n">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="na">withPredicate</span><span class="p">(</span><span class="k">new</span> <span class="n">Predicate</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;description&quot;</span><span class="p">,</span><span class="k">new</span> <span class="n">EventFilter</span><span class="p">(</span><span class="n">clientId</span><span class="p">)))</span>
    <span class="p">.</span><span class="na">withRequestPreprocessor</span><span class="p">(</span><span class="n">preProcessor</span><span class="p">)</span>
    <span class="p">.</span><span class="na">withRequestPostprocessor</span><span class="p">(</span><span class="n">postProcessor</span><span class="p">)</span>
    <span class="p">.</span><span class="na">build</span><span class="p">();</span>

    <span class="n">observable</span><span class="p">.</span><span class="na">subscribe</span><span class="p">();</span>

    <span class="n">sink</span><span class="p">.</span><span class="na">call</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">portRequest</span><span class="p">,</span> <span class="n">observable</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span> <span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;{\&quot;amazon.availability-zone\&quot;:\&quot;us-east-1e\&quot;,\&quot;status\&quot;:200,\&quot;type\&quot;:\&quot;EVENT\&quot;,\&quot;matched-clients\&quot;:\&quot;client6\&quot;,\&quot;currentTime\&quot;:1409595016697,\&quot;duration-millis\&quot;:172}&quot;</span><span class="p">;</span>

    <span class="kt">byte</span> <span class="o">[]</span> <span class="n">barr</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="na">getBytes</span><span class="p">(</span><span class="n">Charsets</span><span class="p">.</span><span class="na">UTF_8</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;size: &quot;</span> <span class="o">+</span> <span class="n">barr</span><span class="p">.</span><span class="na">length</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<!-- Do not edit below this line -->

<!-- START -->

<!-- This section comes from the file "reference_links". It is automagically inserted into other files by means of the "refgen" script, also in the "docs/" directory. Edit this section only in the "reference_links" file, not in any of the other files in which it is included, or your edits will be overwritten. -->

<!-- END -->
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../stage/" title="The Processing Stage Component" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                The Processing Stage Component
              </span>
            </div>
          </a>
        
        
          <a href="../wordcount/" title="Writing Your First Job" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Writing Your First Job
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="https://twitter.com/NetflixOSS" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://netflix.github.io/" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>