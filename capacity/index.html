



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Mantis Job Capacity Planning & Sizing - Mantis</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#background" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Mantis" class="md-header-nav__button md-logo">
          
            <img src="../images/logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Mantis
            </span>
            <span class="md-header-nav__topic">
              
                Mantis Job Capacity Planning & Sizing
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/netflix/mantis/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Github
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Mantis" class="md-nav__button md-logo">
      
        <img src="../images/logo.png" width="48" height="48">
      
    </a>
    Mantis
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/netflix/mantis/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Github
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Welcome to Mantis" class="md-nav__link">
      Welcome to Mantis
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../gettingstarted/" title="Getting Started Guide" class="md-nav__link">
      Getting Started Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gettingstarted/local/" title="Explore a Mantis Job locally" class="md-nav__link">
      Explore a Mantis Job locally
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gettingstarted/docker/" title="Mantis Cluster using Docker" class="md-nav__link">
      Mantis Cluster using Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gettingstarted/cloud/" title="Mantis Cluster in the cloud" class="md-nav__link">
      Mantis Cluster in the cloud
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-5" type="checkbox" id="nav-2-5">
    
    <label class="md-nav__link" for="nav-2-5">
      Mantis Samples
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-5">
        Mantis Samples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../gettingstarted/samples/sinesample/" title="Sine Function" class="md-nav__link">
      Sine Function
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gettingstarted/samples/twittersample/" title="Twitter Sample" class="md-nav__link">
      Twitter Sample
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gettingstarted/samples/publishsample/" title="Publish to Mantis Sample" class="md-nav__link">
      Publish to Mantis Sample
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../infrastructure/" title="Infrastructure Overview" class="md-nav__link">
      Infrastructure Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../concepts/" title="Mantis Concepts" class="md-nav__link">
      Mantis Concepts
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../usecases/" title="Use cases" class="md-nav__link">
      Use cases
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Writing Mantis Jobs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Writing Mantis Jobs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../writingjobs/" title="Introduction to Mantis Jobs" class="md-nav__link">
      Introduction to Mantis Jobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../writingjobs/source/" title="The Source Component" class="md-nav__link">
      The Source Component
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../writingjobs/stage/" title="The Processing Stage Component" class="md-nav__link">
      The Processing Stage Component
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../writingjobs/sink/" title="The Sink Component" class="md-nav__link">
      The Sink Component
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Mantis Query Language
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Mantis Query Language
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../MQL/" title="Introduction to MQL" class="md-nav__link">
      Introduction to MQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../MQL/operators/" title="Operators" class="md-nav__link">
      Operators
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../MQL/sampling/" title="Sampling" class="md-nav__link">
      Sampling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../MQL/aggregation-scaling-limits/" title="Scaling Limits" class="md-nav__link">
      Scaling Limits
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../autoscaling/" title="Mantis Job Autoscaling" class="md-nav__link">
      Mantis Job Autoscaling
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../internals/mre/" title="Publishing Events to Mantis" class="md-nav__link">
      Publishing Events to Mantis
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      The Mantis API
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        The Mantis API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../mantisapi/" title="Mantis API Reference" class="md-nav__link">
      Mantis API Reference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mantisapi/websocket/" title="Mantis Websocket API" class="md-nav__link">
      Mantis Websocket API
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cli/" title="The Mantis CLI" class="md-nav__link">
      The Mantis CLI
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      Mantis Internals
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        Mantis Internals
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../internals/sourcejobs/" title="Mantis Source Jobs" class="md-nav__link">
      Mantis Source Jobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../internals/runtime/" title="Mantis Runtime" class="md-nav__link">
      Mantis Runtime
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../localdevelopment/localdockersetup/" title="Local Development" class="md-nav__link">
      Local Development
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Mantis Job Capacity Planning & Sizing
      </label>
    
    <a href="./" title="Mantis Job Capacity Planning & Sizing" class="md-nav__link md-nav__link--active">
      Mantis Job Capacity Planning & Sizing
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#background" class="md-nav__link">
    Background
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mantis-jobs" class="md-nav__link">
    Mantis Jobs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kafka-source-jobs" class="md-nav__link">
    Kafka Source Jobs
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../community/" title="Community" class="md-nav__link">
      Community
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../faq/" title="Mantis FAQ" class="md-nav__link">
      Mantis FAQ
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../glossary/" title="Glossary" class="md-nav__link">
      Glossary
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#background" class="md-nav__link">
    Background
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mantis-jobs" class="md-nav__link">
    Mantis Jobs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kafka-source-jobs" class="md-nav__link">
    Kafka Source Jobs
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/netflix/mantis/edit/master/docs/capacity.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Mantis Job Capacity Planning & Sizing</h1>
                
                <h2 id="background">Background<a class="headerlink" href="#background" title="Permanent link">&para;</a></h2>
<p><a href="../glossary#job" title="A Mantis Job takes in a stream of data, transforms it by using RxJava operators, and then outputs the results as another stream. It is composed of a Source, one or more Processing Stages, and a Sink.">Mantis Jobs</a> consist of one or more independent <a href="../glossary#stage" title="A Processing Stage component of a Mantis Job transforms the RxJava Observables it obtains from the Source component.">stages</a>. Since stages are independent of one
another, they are also sized independently.</p>
<p>Stages have one or more <a href="../glossary#worker" title="A worker is the smallest unit of work that is scheduled within a Mantis component. You can configure how many resources Mantis allocates to each worker, and Mantis will adjust the number of workers your Mantis component needs based on its autoscaling policy.">workers</a>, which are the fundamental unit of parallelism for a stage.
Workers execute individual instances of a stage and are each allocated CPU, memory, disk, and
network resources. Workers are also isolated from one another, which means they process events
independently of each other using their own dedicated resources.</p>
<p>You can horizontally scale your Mantis Jobs by modifying the number of workers of your stages. You
can also vertically scale your Mantis Jobs by tuning the number of resources for each worker.</p>
<p>The following sections are guidelines for sizing different types of Mantis Jobs.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can modify worker resources any time, even after you have already launched the Mantis Job.
This is useful in cases where you might want to adjust your Mantis Job to new traffic patterns.
You can do this by marking your stage as <em>Stage is Scalable</em>.</p>
<p>You can also mark the stage as <em>AutoScale this stage</em> to have Mantis automatically scale the
stage.</p>
<p>You can horizontally scale your Mantis Jobs without restarting the entire job. However,
vertically scaling your jobs requires a new job submission for changes to take effect.</p>
</div>
<h2 id="mantis-jobs">Mantis Jobs<a class="headerlink" href="#mantis-jobs" title="Permanent link">&para;</a></h2>
<p>In addition to scaling the number of workers of a Mantis Job, you should consider tuning your
workers, which have two tunable properties: processing resources and processing parallelism.</p>
<p>For <strong>processing resources</strong>, you should generally determine if <strong>CPU</strong>, <strong>memory</strong>, or <strong>network
resources</strong> will be a bottleneck in your processing. You should increase:</p>
<ul>
<li>the number of CPUs if your job has CPU-intensive transformations such as serialization and
  deserialization</li>
<li>memory if your job plans to hold many objects or large objects in memory</li>
<li>network resources if your job needs high throughput for network I/O such as external API calls</li>
</ul>
<p>For <strong>processing parallelism</strong>, you must choose between <strong>serial</strong> or <strong>concurrent input</strong>
processing for each stage.</p>
<p><strong>Serial input</strong> processing means your <a href="../glossary#stage" title="A Processing Stage component of a Mantis Job transforms the RxJava Observables it obtains from the Source component.">Processing Stage</a> will receive and process events within a
single thread. With serial input, you lose parallelism but your processing logic becomes
straightforward without race conditions.</p>
<div class="codehilite"><pre><span></span><span class="c1">// Specifying serial input for a stage.</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SerialStage</span> <span class="kd">implements</span> <span class="n">ScalarComputation</span><span class="o">&lt;</span><span class="n">T1</span><span class="o">,</span> <span class="n">T2</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="kd">public</span> <span class="n">ScalarToScalar</span><span class="o">.</span><span class="na">Config</span><span class="o">&lt;</span><span class="n">T1</span><span class="o">,</span> <span class="n">T2</span><span class="o">&gt;</span> <span class="nf">config</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">ScalarToScalar</span><span class="o">.</span><span class="na">Config</span><span class="o">&lt;</span><span class="n">T1</span><span class="o">,</span> <span class="n">T2</span><span class="o">&gt;().</span><span class="na">serialInput</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p><strong>Concurrent input</strong> means your <a href="../glossary#stage" title="A Processing Stage component of a Mantis Job transforms the RxJava Observables it obtains from the Source component.">Processing Stage</a> will have multiple threads which each receive and
process events. With concurrent input enabled, race conditions must be considered because the stage’s
threads operate independently from one another and may process events at different speeds.</p>
<div class="codehilite"><pre><span></span><span class="c1">// Specifying concurrent input for a stage.</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SerialStage</span> <span class="kd">implements</span> <span class="n">ScalarComputation</span><span class="o">&lt;</span><span class="n">T1</span><span class="o">,</span> <span class="n">T2</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="kd">public</span> <span class="n">ScalarToScalar</span><span class="o">.</span><span class="na">Config</span><span class="o">&lt;</span><span class="n">T1</span><span class="o">,</span> <span class="n">T2</span><span class="o">&gt;</span> <span class="nf">config</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">ScalarToScalar</span><span class="o">.</span><span class="na">Config</span><span class="o">&lt;</span><span class="n">T1</span><span class="o">,</span> <span class="n">T2</span><span class="o">&gt;().</span><span class="na">concurrentInput</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Workers use serial input by default.</p>
</div>
<h2 id="kafka-source-jobs">Kafka Source Jobs<a class="headerlink" href="#kafka-source-jobs" title="Permanent link">&para;</a></h2>
<p><a href="../glossary#kafka" title="Apache Kafka is a large-scale, distributed streaming platform.">Kafka</a>  <a href="../glossary#sourcejob" title="A Source Job is a Mantis Job that you can use as a Source, which wraps a data source external to Mantis and makes it easier for you to create a job that observes its data.">Source Jobs</a> are Mantis Jobs that share the same properties described above, except Kafka
Source Jobs use concurrent input processing by default. There are additional job <a href="../glossary#parameter" title="A Mantis Job may accept parameters that modify its behavior. You can define these in your Job Cluster definition, and set their values on a per-Job basis.">parameters</a> to
consider when tuning Kafka Source Jobs: <code>numConsumerInstances</code> and <code>stageConcurrency</code>.</p>
<p>The <code>numConsumerInstances</code> <a href="../glossary#property" title="A property is a particular named data value found within events in an event stream.">property</a> <!-- "property" or "parameter" (see previous paragraph)? --> determines how many Kafka consumers will be created for
each worker. For example, if you have <code>numConsumerInstances</code> set to <code>2</code> and have 5 workers,
then you will have 10 Kafka consumers in total for your Mantis Job consuming from a Kafka topic.</p>
<p>The <code>stageConcurrency</code> property determines a pool of threads which receive events by the
Kafka consumers. You can control your processing parallelism with this property. For example,
if you have <code>numConsumerInstances</code> set to <code>2</code> and <code>stageConcurrency</code> set to 5 on a worker,
then two Kafka consumers will read events from a Kafka topic and asynchronously send them to a
pool of 5 processing threads.</p>
<p>There are three considerations for using <code>numConsumerInstances</code> and <code>stageConcurrency</code> to tune your
Kafka Source Job.</p>
<p>First, you can pin <code>numConsumerInstances</code> to <code>1</code> and add more workers to load balance Kafka
consumers across worker instances.</p>
<p>If you find that your workers are under-utilized, you can increase <code>numConsumerInstances</code> for each
worker. You can also give each worker more CPU, memory, and network resources and
increase <code>numConsumerInstances</code> further so that you have fewer workers doing more work.</p>
<p>Lastly, if you find that your Kafka topic’s lag is increasing, then processing might be a
bottleneck. In this case, you can increase <code>stageConcurrency</code> to increase processing throughput.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Adding more workers to scale your Kafka Source Jobs to increase throughput or address lag has a
hard upper limit. Ensure that you do not have more Kafka consumers than the number of partitions
of the Kafka topic that your job is reading from. Specifically, ensure that:</p>
<p><span><span class="MathJax_Preview">(numConsumerInstances × numberOfWorkers) ≤ numberOfPartitions</span><script type="math/tex">(numConsumerInstances × numberOfWorkers) ≤ numberOfPartitions</script></span></p>
<p>This is because the number of partitions is a Kafka topic’s upper bound for parallelism. If you
exceed this number, then you will have idle consumers wasting resources which means adding more
workers to your Kafka Source Job will not have any positive effect.</p>
</div>
<!-- Do not edit below this line -->

<!-- START -->

<!-- This section comes from the file "reference_links". It is automagically inserted into other files by means of the "refgen" script, also in the "docs/" directory. Edit this section only in the "reference_links" file, not in any of the other files in which it is included, or your edits will be overwritten. -->

<!-- END -->
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../localdevelopment/localdockersetup/" title="Local Development" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Local Development
              </span>
            </div>
          </a>
        
        
          <a href="../community/" title="Community" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Community
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://twitter.com/NetflixOSS" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://netflix.github.io/" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>