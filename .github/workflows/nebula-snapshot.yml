name: "Publish snapshot to NetflixOSS and Maven Central"

on:
  pull_request_target:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - name: Setup jdk
        uses: actions/setup-java@v2
        with:
          java-version: 8
          distribution: 'zulu'
      - name: Build
        uses: gradle/gradle-build-action@v2
        env:
          NETFLIX_OSS_SIGNING_KEY: ${{ secrets.ORG_SIGNING_KEY }}
          NETFLIX_OSS_SIGNING_PASSWORD: ${{ secrets.ORG_SIGNING_PASSWORD }}
          NETFLIX_OSS_REPO_USERNAME: ${{ secrets.ORG_NETFLIXOSS_USERNAME }}
          NETFLIX_OSS_REPO_PASSWORD: ${{ secrets.ORG_NETFLIXOSS_PASSWORD }}
        with:
          arguments: --info --stacktrace build -x test snapshot
      - name: Create PR Comment String
        run: |
          MY_STRING=$(cat ${GITHUB_WORKSPACE}/build/versions.txt)
          echo "::set-output name=content::$MY_STRING"
          id: my_string
      - name: Upload
        uses: mshick/add-pr-comment@v1
        with:
          message: |
            **Uploaded Artifacts**
            "${{ steps.my_string.outputs.content }}"
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          allow-repeats: false # This is the default
